<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Display a map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js"></script>
  <script src="https://bundle.run/osmtogeojson@3.0.0-beta.4"></script>
  <link href="https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script type=module>

  const style = {"version":8,"sources":{"raster-tiles":{"type":"raster","url":"https://api.maptiler.com/maps/toner/tiles.json?key=j20l9qIApPvfmDy7ZuPM"}},"layers":[{"id":"simple-tiles","type":"raster","source":"raster-tiles"}]};

  const map = new maplibregl.Map({
    container: document.getElementById('map'),
    style,
    center: [-80, 40.44],
    zoom: 10,
  });

  const osm_data = await fetch('osm_data.json');
  const geojson = osmtogeojson(await osm_data.json());

  map.addSource('osm_data', {
    'type': 'geojson',
    'data': geojson,
    'promoteId': 'id',
  });

  map.addLayer({
    'type': 'line',
    'id': 'osm_data',
    'source': 'osm_data',
    'layout': {
      'line-join': 'round',
      'line-cap': 'round'
    },
    'paint': {
      'line-color': [
        'case', ['boolean', ['feature-state', 'hover'], false],
        '#808',
        '#f0f',
      ],
      'line-width': 5
    }
  });

  let hoveredId = null;

  map.on('mousemove', 'osm_data', (e) => {
    if (e.features.length > 0) {
      if (hoveredId !== null) {
        map.setFeatureState(
          { source: 'osm_data', id: hoveredId },
          { hover: false },
        );
      }
      hoveredId = e.features[0].id;
      map.setFeatureState(
        { source: 'osm_data', id: hoveredId },
        { hover: true }
      );
    }
  });

  map.on('mouseleave', 'osm_data', () => {
    if (hoveredId !== null) {
      map.setFeatureState(
        { source: 'osm_data', id: hoveredId },
        { hover: false },
      );
    }
    hoveredId = null;
  });

</script>
